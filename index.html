<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="vendor/tinycolor.js"></script>
    <script src="supersymmetry.js"></script>
</head>
<body>
<div class="board">
    <canvas id="game" width="500" height="500" style="border: 1px solid black"></canvas>

    <form id="controls" style="border: 1px solid black; width: 500px;">
        <fieldset>
            <legend>Status</legend>
            <label for="current-player">Current player</label>
            <input type="text" disabled value="" id="current-player">
            <br/>
            <label for="error">Last error</label>
            <textarea disabled rows="1" cols="32" id="error"></textarea>
        </fieldset>

        <fieldset>
            <legend>Move</legend>
            <input type="button" value="Reset move" id="button-reset-move" disabled>
            <input type="button" value="Do move" id="button-do-move" disabled>
        </fieldset>

        <fieldset>
            <legend>Start new game</legend>
            <fieldset>
                <legend>Add players</legend>
                <label for="player-username">Username</label>
                <input type="text" size="10" id="player-username">
                <label for="player-color">Color</label>
                <select id="player-color">
                    <option id="select-black">black</option>
                    <option id="select-blue">blue</option>
                    <option id="select-white">white</option>
                    <option id="select-red">red</option>
                    <option id="select-yellow">yellow</option>
                    <option id="select-green">green</option>
                </select>
                <input type="button" value="Add player" id="button-add-player">
                <br/>
                <h3>Players in the next game:</h3>
                <ul id="player-list">

                </ul>
            </fieldset>
            <br/>
            <label for="base-size">Base size</label>
            <input type="number" value="4" max="10" min="1" size="1" id="base-size" style="width: 40px;">
            <input type="button" value="Start new game" id="button-reset-game">
        </fieldset>
    </form>
</div>
</div>
</body>

<script>
    const canvas = document.getElementById('game');

    const players = [];

    function startGame(n) {
        const board = new Board(n);
        board.drawing.ctx = canvas.getContext('2d');
        board.drawing.unit = 25;
        board.drawing.yOffset = 70;
        board.drawing.xOffset = -60;
        //board.movePiece()
        if (players.length) {
            for (let p = 0; p < players.length; p++) {
                board.addPlayer(players[p].username, players[p].color);
            }
            board.setCurrentPlayer(players[0].color);
        } else {
            document.getElementById('error').value = "There are no players";
        }

        board.init();
        board.reportError = err => document.getElementById('error').value = err;
        return board;
    }

    let board = startGame(4);
    const updatePlayer = () => document.getElementById('current-player').value = `${board.game.currentPlayer.username} - ${board.game.currentPlayer.color}`;

    document.getElementById('controls').reset();
    document.getElementById('button-reset-game').addEventListener('click', () => {
        board = startGame(document.getElementById('base-size').value);
        updatePlayer();
        document.getElementById('button-do-move').disabled = false;
        document.getElementById('button-reset-move').disabled = false;
    });
    document.getElementById('button-do-move').addEventListener('click', () => {
        board.doMoves();
        updatePlayer();
    });
    document.getElementById('button-reset-move').addEventListener('click', () => {
        board.resetMoves();
    });
    document.getElementById('button-add-player').addEventListener('click', () => {
        const player = {
            color: document.getElementById('player-color').value,
            username: document.getElementById('player-username').value
        };
        players.push(player);

        const liNode = document.createElement('li');
        liNode.id = player.username;
        const textNode = document.createTextNode(`${player.username} - ${player.color}`);
        liNode.appendChild(textNode);
        document.getElementById('player-list').appendChild(liNode);
        const optionNode = document.getElementById(`select-${player.color}`);
        optionNode.parentNode.removeChild(optionNode);
    });
</script>
</html>